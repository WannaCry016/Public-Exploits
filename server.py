from flask import Flask, request, jsonify
import os
import logging
from datetime import datetime

app = Flask(__name__)

# Directory to save incoming logs
LOG_DIR = "received_logs"
os.makedirs(LOG_DIR, exist_ok=True)

# Set up logging
logging.basicConfig(filename='server.log', level=logging.DEBUG, format='%(asctime)s %(levelname)s: %(message)s')

@app.route('/upload', methods=['POST'])
def upload_log():
    data = request.get_json()
    if not data or 'log_content' not in data:
        return jsonify({"status": "failure", "message": "Invalid request format"}), 400

    # Save the received log
    try:
        log_file_name = f"log_{datetime.now().strftime('%Y%m%d%H%M%S')}.txt"
        log_file_path = os.path.join(LOG_DIR, log_file_name)
        with open(log_file_path, 'w') as log_file:
            log_file.write(data['log_content'])
        
        logging.info(f"Log received and saved as {log_file_path}")
        return jsonify({"status": "success", "message": f"Log saved as {log_file_name}"}), 200
    except Exception as e:
        logging.error(f"Error saving log: {e}")
        return jsonify({"status": "failure", "message": f"Error saving log: {e}"}), 500

if __name__ == "__main__":
    app.run(host='0.0.0.0', port=5000)
